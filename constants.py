import json
from pydantic import BaseModel, Field
from web3 import Web3
from fastapi.openapi.utils import get_openapi

# main_contract_address = "0x45E8c7346C5f1a21d5494E87ED6F19E1F6177dC2" # This is the main contract address deployed in goerli
wallet_address = "0xb5b5FF0987067f166169f082c174402277987f35" # You can replace this address with your own public address
private_key = "04910f1bed2f8ea83b422f58b4a5bc8602cf11f283c29be63d77d994310ed61e" # You can replace it with your own private key
infura_api = "" # Create your own infura api key and put the endpoint here (Put the endpoint for goerli network)

# Dont make any changes to the abi and byte code

abi = json.loads('[ { "constant": true, "inputs": [], "name": "getVotingDetails", "outputs": [ { "name": "", "type": "string" }, { "name": "", "type": "string" }, { "name": "", "type": "int256" }, { "name": "", "type": "int256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "candidate", "type": "string" }, { "name": "castId", "type": "int256" } ], "name": "castVote", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "getLiveCount", "outputs": [ { "name": "", "type": "int256[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "getPollStatus", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "hasUserVoted", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "getPollResult", "outputs": [ { "name": "", "type": "string" }, { "name": "", "type": "int256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "getOptionList", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "inputs": [ { "name": "_options", "type": "bytes32[]" }, { "name": "_votingTitle", "type": "string" }, { "name": "_maxVoteAllowed", "type": "int256" } ], "payable": false, "stateMutability": "nonpayable", "type": "constructor" } ]')

byte_code = "60806040526003604051908082528060200260200182016040528015620000355781602001602082028038833980820191505090505b50600290805190602001906200004d92919062000551565b503480156200005b57600080fd5b50604051620015ef380380620015ef83398101806040528101908080518201929190602001805182019291906020018051906020019092919050505060608360009080519060200190620000b1929190620005a3565b50620000cb62000140640100000000026401000000009004565b9050606060405190810160405280828152602001848152602001838152506003600082015181600001908051906020019062000109929190620005fb565b50602082015181600101908051906020019062000128929190620005fb565b50604082015181600201559050505050505062000781565b606060008090505b600080549050811015620002a65760016200018c6000838154811015156200016c57fe5b90600052602060002001546200034b640100000000026401000000009004565b6040516020018083805460018160011615610100020316600290048015620001ee5780601f10620001cb576101008083540402835291820191620001ee565b820191906000526020600020905b815481529060010190602001808311620001d9575b505082805190602001908083835b602083101515620002235780518252602082019150602081019050602083039250620001fc565b6001836020036101000a038019825116818451168082178552505050505050905001807f2c0000000000000000000000000000000000000000000000000000000000000081525060010192505050604051602081830303815290604052600190805190602001906200029792919062000682565b50808060010191505062000148565b60018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015620003405780601f10620003145761010080835404028352916020019162000340565b820191906000526020600020905b8154815290600101906020018083116200032257829003601f168201915b505050505091505090565b6060806000806000606060206040519080825280601f01601f1916602001820160405280156200038a5781602001602082028038833980820191505090505b50945060009350600092505b602083101562000458578260080260020a876001900402600102915060007f010000000000000000000000000000000000000000000000000000000000000002827effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff19161415156200044a578185858151811015156200041157fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535083806001019450505b828060010193505062000396565b836040519080825280601f01601f1916602001820160405280156200048c5781602001602082028038833980820191505090505b509050600092505b8383101562000544578483815181101515620004ac57fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f01000000000000000000000000000000000000000000000000000000000000000281848151811015156200050657fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350828060010193505062000494565b8095505050505050919050565b82805482825590600052602060002090810192821562000590579160200282015b828111156200058f57825182559160200191906001019062000572565b5b5090506200059f919062000709565b5090565b828054828255906000526020600020908101928215620005e8579160200282015b82811115620005e7578251829060001916905591602001919060010190620005c4565b5b509050620005f7919062000731565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200063e57805160ff19168380011785556200066f565b828001600101855582156200066f579182015b828111156200066e57825182559160200191906001019062000651565b5b5090506200067e919062000759565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620006c557805160ff1916838001178555620006f6565b82800160010185558215620006f6579182015b82811115620006f5578251825591602001919060010190620006d8565b5b50905062000705919062000759565b5090565b6200072e91905b808211156200072a57600081600090555060010162000710565b5090565b90565b6200075691905b808211156200075257600081600090555060010162000738565b5090565b90565b6200077e91905b808211156200077a57600081600090555060010162000760565b5090565b90565b610e5e80620007916000396000f300608060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806319c0c51a1461008857806360e3f3fa1461019257806368613e1f1461021d578063883032e81461028957806397371c04146102b85780639daf2078146102e7578063c198a5391461037e575b600080fd5b34801561009457600080fd5b5061009d61040e565b604051808060200180602001858152602001848152602001838103835287818151815260200191508051906020019080838360005b838110156100ed5780820151818401526020810190506100d2565b50505050905090810190601f16801561011a5780820380516001836020036101000a031916815260200191505b50838103825286818151815260200191508051906020019080838360005b83811015610153578082015181840152602081019050610138565b50505050905090810190601f1680156101805780820380516001836020036101000a031916815260200191505b50965050505050505060405180910390f35b34801561019e57600080fd5b50610203600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192908035906020019092919050505061056d565b604051808215151515815260200191505060405180910390f35b34801561022957600080fd5b50610232610675565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561027557808201518184015260208101905061025a565b505050509050019250505060405180910390f35b34801561029557600080fd5b5061029e610684565b604051808215151515815260200191505060405180910390f35b3480156102c457600080fd5b506102cd610693565b604051808215151515815260200191505060405180910390f35b3480156102f357600080fd5b506102fc6106aa565b6040518080602001838152602001828103825284818151815260200191508051906020019080838360005b83811015610342578082015181840152602081019050610327565b50505050905090810190601f16801561036f5780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b34801561038a57600080fd5b5061039361075d565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103d35780820151818401526020810190506103b8565b50505050905090810190601f1680156104005780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60608060008060036000016003600101600360020154600854838054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156104bc5780601f10610491576101008083540402835291602001916104bc565b820191906000526020600020905b81548152906001019060200180831161049f57829003601f168201915b50505050509350828054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105585780601f1061052d57610100808354040283529160200191610558565b820191906000526020600020905b81548152906001019060200180831161053b57829003601f168201915b50505050509250935093509350935090919293565b60008061057983610802565b801561058a575061058984610859565b5b801561059b57506105996108c6565b155b1561064e576105a9846108e9565b90506001600a6000836000191660001916815260200190815260200160002060008282540192505081905550600160086000828254019250508190555060028390806001815401808255809150509060018203906000526020600020016000909192909190915055506001600960006101000a81548160ff021916908315150217905550600360020154600854141561064557610644610914565b5b6001915061066e565b6000600960006101000a81548160ff021916908315150217905550600091505b5092915050565b606061067f6109fa565b905090565b600061068e6108c6565b905090565b6000600960009054906101000a900460ff16905090565b606060006006600001600660010154818054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561074e5780601f106107235761010080835404028352916020019161074e565b820191906000526020600020905b81548152906001019060200180831161073157829003601f168201915b50505050509150915091509091565b606060036000018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107f85780601f106107cd576101008083540402835291602001916107f8565b820191906000526020600020905b8154815290600101906020018083116107db57829003601f168201915b5050505050905090565b600080600090505b60028054905081101561084e578260028281548110151561082757fe5b906000526020600020015414156108415760009150610853565b808060010191505061080a565b600191505b50919050565b6000806000610867846108e9565b9150600090505b6000805490508110156108ba5760008181548110151561088a57fe5b906000526020600020015460001916826000191614156108ad57600192506108bf565b808060010191505061086e565b600092505b5050919050565b60006003600201546008541215156108e157600190506108e6565b600090505b90565b60006060829050600081511415610906576000600102915061090e565b602083015191505b50919050565b600060606000806109236108c6565b156109f45760009350600091505b6000805490508210156109b257600a6000808481548110151561095057fe5b90600052602060002001546000191660001916815260200190815260200160002054905083811215156109a5578093506109a260008381548110151561099257fe5b9060005260206000200154610b1f565b92505b8180600101925050610931565b604080519081016040528084815260200185815250600660008201518160000190805190602001906109e5929190610d1b565b50602082015181600101559050505b50505050565b60606000806000604051908082528060200260200182016040528015610a2f5781602001602082028038833980820191505090505b50600b9080519060200190610a45929190610d9b565b50600091505b600080549050821015610ac757600a60008084815481101515610a6a57fe5b906000526020600020015460001916600019168152602001908152602001600020549050600b8190806001815401808255809150509060018203906000526020600020016000909192909190915055508180600101925050610a4b565b600b805480602002602001604051908101604052809291908181526020018280548015610b1357602002820191906000526020600020905b815481526020019060010190808311610aff575b50505050509250505090565b6060806000806000606060206040519080825280601f01601f191660200182016040528015610b5d5781602001602082028038833980820191505090505b50945060009350600092505b6020831015610c27578260080260020a876001900402600102915060007f010000000000000000000000000000000000000000000000000000000000000002827effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916141515610c1a57818585815181101515610be157fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535083806001019450505b8280600101935050610b69565b836040519080825280601f01601f191660200182016040528015610c5a5781602001602082028038833980820191505090505b509050600092505b83831015610d0e578483815181101515610c7857fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f0100000000000000000000000000000000000000000000000000000000000000028184815181101515610cd157fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508280600101935050610c62565b8095505050505050919050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610d5c57805160ff1916838001178555610d8a565b82800160010185558215610d8a579182015b82811115610d89578251825591602001919060010190610d6e565b5b509050610d979190610de8565b5090565b828054828255906000526020600020908101928215610dd7579160200282015b82811115610dd6578251825591602001919060010190610dbb565b5b509050610de49190610e0d565b5090565b610e0a91905b80821115610e06576000816000905550600101610dee565b5090565b90565b610e2f91905b80821115610e2b576000816000905550600101610e13565b5090565b905600a165627a7a72305820fa21cbd849f3abfe8875181c3f13fbdaebce0cfa40c9bfeed0b1ccb213c5e5190029"
web3 = Web3(Web3.HTTPProvider(infura_api))


def init_contract():
    return web3.eth.contract(abi=abi, bytecode=byte_code)

def get_contract(contract : str):
    contract = web3.toChecksumAddress(contract)
    contract_instance = web3.eth.contract(address=contract, abi=abi)
    return contract_instance
